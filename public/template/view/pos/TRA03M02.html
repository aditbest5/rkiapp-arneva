<script>
    var isiTable;

    function setDefault() {
        //koperasi();
        selAllItem("");
        let h = screen.height;
        var a = (h - 100) * 45 / 100;
        var b = (h - 100) * 75 / 100;
        document.getElementById("itemPos").style.height = a + "px";
        //document.getElementById("all").style.height = b + "px";
        document.getElementById("posItem").style.height = b + "px";
        document.getElementById("posItemFood").style.height = b + "px";
        document.getElementById("posItemNonFood").style.height = b + "px";
        //getTokenKaspro('LOAD', 'kasProCustomerAccountInquery'); di gunakan untuk menampilkan saldo kaspro jika di butuhkan
        posSetting();
    }


    var jumlah_pos = 0;
    var d = new Date();
    var pktr = d.getFullYear() + "" + d.getMonth() + "" + d.getDate() + "" + d.getHours() + "" + d.getMinutes() + "" + d.getSeconds() + d.getMilliseconds();
    var struk = "";
    var strukDtl = "";

    function posSetting() {
        $.post("https://api-rki.rkicoop.co.id/api/pos/QueryPos", {
            cmd: "selPosDefaultSetting",
            kop_id: $("#login_kop_id").val()
        },
            function (data, status) {
                //alert("Data: " + data + "\nStatus: " + status);
                const myArr = JSON.parse(data);
                //console.log(myArr);
                var b = "";

                if (myArr.length == 0) {
                    salert("Tidak Ada Default Setting Untuk UserID Ini");
                    console.log('Tidak Ada Default Setting Untuk UserID Ini');
                } else {
                    for (var i = 0; i < myArr.length; i += 1) {
                        if (myArr[i]["detailName"] == "PPN") {
                            $("#ppnYn").val(myArr[i]["detailName2"]);
                        }
                        if (myArr[i]["detailName"] == "PRINTER") {
                            $("#strukYn").val(myArr[i]["detailName2"]);
                        }
                    }
                }
            }).fail(function (e) {
                console.log(e);
                //salert("Error: " + e, 'warning', 'Warning');
                // Handle error here
            });
    }


    function searchItem() {
        selAllItem("");
    }

    function refreshItem() {
        $("#textAllSearch").val("");
        selAllItem("");
    }

    function selAllItem(kategori) {
        var y = new Date();
        var imageRefresh = y.getFullYear() + "" + y.getMonth() + "" + y.getDate() + "" + y.getHours() + "" + y.getMinutes() + "" + y.getSeconds() + y.getMilliseconds();
        var itemNm = "";
        if (kategori == "") { itemNm = $("#textAllSearch").val() }
        $.post("https://api-rki.rkicoop.co.id/api/pos/QueryPos", {
            cmd: "selAllItem",
            kop_id: $("#login_kop_id").val(),
            toko_id: $("#login_toko_id").val(),
            kategori: kategori,
            itemNm: $("#textAllSearch").val()
        },
            function (data, status) {
                const myArr = JSON.parse(data);
                //console.log(myArr);
                var b = "";
                var nama = "";
                var fotoNm = "";
                if (myArr.length == 0) {
                    salert("Tidak Ada Data", 'warning', 'Warning');
                } else {

                    for (var i = 0; i < myArr.length; i += 1) {
                        if (myArr[i]["nama_barang"].length > 25) { nama = myArr[i]["nama_barang"].substring(0, 25) + "..." } else { nama = myArr[i]["nama_barang"] };


                        b = b + " <div class='col-6 col-xs-6 col-sm-6 col-md-4 col-lg-2  mt-2' style='cursor:pointer;' ";

                        if (myArr[i]["kategori"] != "000003") {
                            //b = b + "  onclick=\"cekBarang('" + myArr[i]["idx"] + "')\"  > ";
                            b = b + ">";
                        } else {
                            //b = b + "   onclick=\"openModalPPOB()\"  > ";
                            b = b + ">";
                        }

                        if (myArr[i]["fotoNm"] == "") {
                            fotoNm = "NOIMAGE";
                        } else {
                            fotoNm = myArr[i]["foto"];
                        }

                        b = b + "    ";
                        b = b + "        <div style='box-shadow:rgb(0 0 0 / 12%) 0px 1px 6px 0px;border-radius:9px;max-height:340px;max-width:200px;' class='rounded' >";

                        b = b + " <div style='width:100%;max-height:130px;height:120px;max-width:120px;margin:auto;' >";
                        b = b + "            <img src='https://storage.googleapis.com/atous-product-images/barang/" + fotoNm + ".jpg?ignoreCache=1&imageRefresh=" + imageRefresh + "' class='rounded' style='width:100%;max-height:130px;height:120px;margin-top:5px;' title='" + myArr[i]["nama_barang"] + "' alt='" + myArr[i]["nama_barang"] + "' >";
                        b = b + " </div>";


                        b = b + "           <div style='height:50px;overflow:hidden;margin-top:5px' >";
                        b = b + "            <div > " + nama + "</div>  ";
                        b = b + "           </div>";
                        if (myArr[i]["kategori"] != "000003") {

                            b = b + "             <div class='font-weight-bold'> Rp " + parseInt(myArr[i]["harga_jual"]).toLocaleString() + "</div>";
                            b = b + " <div class='input-group' style='margin-bottom:0.2em !important;width:100%;'> ";
                            b = b + "<span class='input-group-btn'> ";
                            b = b + " <button type='button' class='btn btn-default btn-number' data-type='minus' style='font-size:15px' ";
                            b = b + " data-field='quant[" + i + "]'> ";
                            b = b + " <i class='fa-solid fa-minus text-danger'></i> ";
                            b = b + " </button> ";
                            b = b + " </span> ";
                            b = b + " <input type='text' style='font-size:12px;text-align: center; ' name='quant[" + i + "]' id='qtyPos" + i + "' class='form-control input-number inputpos' value='1' min='1' ";
                            b = b + " max='100'> ";
                            b = b + " <span class='input-group-btn'> ";
                            b = b + " <button style='font-size:15px;' type='button' class='btn btn-default btn-number' data-type='plus' ";
                            b = b + " data-field='quant[" + i + "]'> ";
                            b = b + " <i class='fa-solid fa-plus text-success'></i> ";
                            b = b + " </button> ";
                            b = b + " </span> ";
                            b = b + " </div> ";

                            b = b + "             <div class='font-weight-bold'><button type='button' onclick=\"cekBarang('" + myArr[i]["idx"] + "'," + i + ")\" class='btn btn-info' style='width:100%;'><i style='font-weight:bold;margin-right:0 !important;' class='fa-solid fa-cart-shopping'></i> Beli</button></div>";
                            b = b + "             <div class='font-weight-bold'> <i style='font-size:12px;color:orange;' class='fa fa-star'></i> </div>";

                        }



                        b = b + "        </div>";
                        b = b + "   ";
                        b = b + " </div>";
                    }
                    b = b + " <div class='col-12' style='height:30px'>&nbsp;</div>";

                    if (kategori == "") {
                        $('#posItem').html(b);
                        $('#posItemFood').html("");
                        $('#posItemNonFood').html("");
                    } else if (kategori == "000001") {
                        $('#posItem').html("");
                        $('#posItemFood').html(b);
                        $('#posItemNonFood').html("");
                    } else if (kategori == "000002") {
                        $('#posItem').html("");
                        $('#posItemFood').html("");
                        $('#posItemNonFood').html(b);
                    } else if (kategori == "000003") {
                        $('#posItemPpob').html(b);
                    }

                    $('.btn-number').click(function (e) {
                        e.preventDefault();

                        fieldName = $(this).attr('data-field');
                        type = $(this).attr('data-type');
                        var input = $("input[name='" + fieldName + "']");
                        var currentVal = parseInt(input.val());
                        if (!isNaN(currentVal)) {
                            if (type == 'minus') {

                                if (currentVal > input.attr('min')) {
                                    input.val(currentVal - 1).change();
                                }
                                if (parseInt(input.val()) == input.attr('min')) {
                                    $(this).attr('disabled', true);
                                }

                            } else if (type == 'plus') {

                                if (currentVal < input.attr('max')) {
                                    input.val(currentVal + 1).change();
                                }
                                if (parseInt(input.val()) == input.attr('max')) {
                                    $(this).attr('disabled', true);
                                }

                            }
                        } else {
                            input.val(0);
                        }
                    });
                    $('.input-number').focusin(function () {
                        $(this).data('oldValue', $(this).val());
                    });
                    $('.input-number').change(function () {

                        minValue = parseInt($(this).attr('min'));
                        maxValue = parseInt($(this).attr('max'));
                        valueCurrent = parseInt($(this).val());

                        name = $(this).attr('name');
                        if (valueCurrent >= minValue) {
                            $(".btn-number[data-type='minus'][data-field='" + name + "']").removeAttr('disabled')
                        } else {
                            alert('Sorry, the minimum value was reached');
                            $(this).val($(this).data('oldValue'));
                        }
                        if (valueCurrent <= maxValue) {
                            $(".btn-number[data-type='plus'][data-field='" + name + "']").removeAttr('disabled')
                        } else {
                            alert('Sorry, the maximum value was reached');
                            $(this).val($(this).data('oldValue'));
                        }


                    });
                    $(".input-number").keydown(function (e) {
                        // Allow: backspace, delete, tab, escape, enter and .
                        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
                            // Allow: Ctrl+A
                            (e.keyCode == 65 && e.ctrlKey === true) ||
                            // Allow: home, end, left, right
                            (e.keyCode >= 35 && e.keyCode <= 39)) {
                            // let it happen, don't do anything
                            return;
                        }
                        // Ensure that it is a number and stop the keypress
                        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                            e.preventDefault();
                        }
                    });
                }
            }).fail(function (e) {
                salert("Error: " + e, 'error', 'Warning');
                // Handle error here
            });
    }


    function savePos() {
        var nama_customer = $('#customer_name').val();
        //var amount = $('#subtotal').text(); amount = amount.replace("Rp", ""); amount = amount.replace(",", ""); amount = amount.replace(".", "");
        var amount = $('#valSubtotal').val();
        //var ppn = $('#ppn').text(); ppn = ppn.replace("Rp", ""); ppn = ppn.replace(",", ""); ppn = ppn.replace(".", "");
        var ppn = $('#ppnVal').val();
        var discount = $('#discount').val();
        //var real_amount = $('#totalBelanja').text(); real_amount = real_amount.replace("Rp", ""); real_amount = real_amount.replace(",", ""); real_amount = real_amount.replace(".", "");
        var real_amount = $('#totalBelanjaVal').val();
        var dibayar = $('#modalTranJumlahUang').val();
        //var kembalian = $('#kembalian').text(); kembalian = kembalian.replace("Rp", ""); kembalian = kembalian.replace(",", ""); kembalian = kembalian.replace(".", "");
        var kembalian = $('#kembalianVal').val();

        //var total_item = $('#totalItemBayar').text(); total_item = total_item.replace("Item", "");
        var total_item = $('#totalItemBayarVal').val();
        var tipe_bayar = $('#modalTranTypeBayar').val();
        var ket = $('#modalTranReason').val();
        var nomor_meja = $('#nomor_meja').val();

        var items = [];
        $('#itemPos .row').each(function () {
            var name = $(this).find('.col-5').text().trim();
            var quantity = parseInt($(this).find('.col-1').text().trim());
            var price = parseInt($(this).find('.col-2').text().trim().replace(/\D/g, ''));

            // Hanya tambahkan item jika name, quantity, dan price adalah nilai yang valid
            if (name && !isNaN(quantity) && !isNaN(price)) {
                items.push({ name: name, quantity: quantity, category: "Food", "url": "www.rkiapp.com", price: price });
            }
        });
        console.log(items)
        var d = new Date();
        var mnth = parseInt(d.getMonth()) + 1;
        var nowe = d.getFullYear() + "-" + mnth + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds() + "." + d.getMilliseconds();
        if (tipe_bayar == '000007') {
            swalStartLoading();
            $.post("https://api-rki.rkicoop.co.id/api/pos/InsUpDelPos", {
                cmd: "insPosSimpleMaster",
                userIns: $('#login_userId').val(),
                kop_id: $("#login_kop_id").val(),
                pk: pktr,
                nama_customer: nama_customer,
                amount: amount,
                ppn: ppn,
                discount: discount,
                real_amount: real_amount,
                dibayar: dibayar,
                kembalian: kembalian,
                total_item: total_item,
                tipe_bayar: tipe_bayar,
                ket: ket,
                nowe: nowe,
                toko_id: $("#login_toko_id").val(),
                noAnngota: $('#login_userId').val(),
                nomor_meja: 1,
            },
                function (data, status) {
                    //alert("Data: " + data + "\nStatus: " + status);
                    var c = 1;
                    var b = "";
                    const myArr = JSON.parse(data);
                    console.log(myArr);
                    if (myArr["sts"] == "OK") {
                        hideModalTran();
                        //salert("Save Complete !", 'success', 'Success');
                        $.ajax({
                            url: "https://xendit-api.arnevats.com/v1/api/xendit/create-payment",
                            type: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({
                                "id_pos": myArr["id_pos"],
                                "amount": real_amount,
                                "fees": [
                                    {
                                        "type": "ADMIN",
                                        "value": 500
                                    }
                                ],
                                'success_redirect_url': 'https://rkiapp.rkicoop.co.id/admin',
                                'failure_redirect_url': 'https://rkiapp.rkicoop.co.id/admin',
                                "customer": {
                                    "given_names": "John",
                                    "surname": "Doe",
                                    "email": "johndoe@example.com",
                                    "mobile_number": "+6287774441111",
                                    "addresses": [
                                        {
                                            "city": "Jakarta Selatan",
                                            "country": "Indonesia",
                                            "postal_code": "12345",
                                            "state": "Daerah Khusus Ibukota Jakarta",
                                            "street_line1": "Jalan Makan",
                                            "street_line2": "Kecamatan Kebayoran Baru"
                                        }
                                    ]
                                },
                                "description": "Pembayaran dengan Xendit",
                                "currency": "IDR",
                                "items": items,
                                "metadata": {
                                    "userIns": $('#login_userId').val().toString(),
                                    "kop_id": $("#login_kop_id").val().toString(),
                                    "pk": pktr.toString(),
                                    "nama_customer": nama_customer.toString(),
                                    "amount": amount.toString(),
                                    "ppn": ppn.toString(),
                                    "discount": discount.toString(),
                                    "real_amount": real_amount.toString(),
                                    "dibayar": dibayar.toString(),
                                    "kembalian": kembalian.toString(),
                                    "total_item": total_item.toString(),
                                    "tipe_bayar": tipe_bayar.toString(),
                                    "ket": ket.toString(),
                                    "nowe": nowe.toString()
                                }

                            }),
                            success: function (data, status) {
                                console.log(data, status);
                                var url = data.invoiceUrl;
                                window.location.href = url;
                                swalFinishLoading();

                            },
                            error: function (e) {
                                console.log(e);
                                // Handle error here
                                swalFinishLoading();
                            }
                        });
                    } else {
                        swalFinishLoading();
                        salert("Error ! " + myArr["desc"] + "\n" + myArr["msg"], 'error', 'Error');
                    }
                }).fail(function (e) {
                    console.log(e);
                    // Handle error here
                    swalFinishLoading();
                });
            $('#totalBelanjaVal').prop('disabled', true);

        }else {

            if ($('#modalTranJumlahUang').val() == "" || $('#modalTranJumlahUang').val() == 0) {
                alert("Harap Isi Jumlah Uang Dahulu !!");
                return;
            }

            if (parseInt(dibayar) - parseInt(real_amount) < 0) {
                alert("Uang Yang Dibayarkan Masih Kurang ! \n Tolong Cek Jumlah Uang Dulu");
                return;
            }
            swalStartLoading();

            $.post("https://api-rki.rkicoop.co.id/api/pos/InsUpDelPos", {
                cmd: "insPosSimpleMaster",
                userIns: $('#login_userId').val(),
                kop_id: $("#login_kop_id").val(),
                pk: pktr,
                nama_customer: nama_customer,
                amount: amount,
                ppn: ppn,
                discount: discount,
                real_amount: real_amount,
                dibayar: dibayar,
                kembalian: kembalian,
                total_item: total_item,
                tipe_bayar: tipe_bayar,
                ket: ket,
                nowe: nowe,
                toko_id: $("#login_toko_id").val(),
                noAnngota: $('#login_userId').val(),
                nomor_meja: 1,
            },
                function (data, status) {
                    //alert("Data: " + data + "\nStatus: " + status);
                    var c = 1;
                    var b = "";
                    const myArr = JSON.parse(data);
                    console.log(myArr);
                    if (myArr["sts"] == "OK") {
                        hideModalTran();
                        //salert("Save Complete !", 'success', 'Success');
                        if ($("#strukYn").val() == "000001") {
                            printStruck(real_amount, dibayar, kembalian, myArr["msg"]);
                        } else if ($("#strukYn").val() == "000002") {
                            printStruck(real_amount, dibayar, kembalian, myArr["msg"]);
                        }
                        salertFunction(myArr["desc"], 'success', 'Success', "cancelBill", "");
                    } else {
                        swalFinishLoading();
                        salert("Error ! " + myArr["desc"] + "\n" + myArr["msg"], 'error', 'Error');
                    }
                }).fail(function (e) {
                    console.log(e);
                    // Handle error here
                    swalFinishLoading();
                });
        }

    }








    function toMoney() {
        if ($("#modalTranJumlahUang").val() == "") {

        } else {
            var belanja = $("#totalBelanja").text();
            var jumlahBelanja = $("#modalTranJumlahUang").val();
            belanja = belanja.replace("Rp ", ""); belanja = belanja.replace(",", ""); belanja = belanja.replace(".", "")
            jumlahBelanja = jumlahBelanja.replace("Rp ", ""); jumlahBelanja = jumlahBelanja.replace(",", ""); jumlahBelanja = jumlahBelanja.replace(".", "");

            var a = 0;
            a = parseInt(jumlahBelanja) - parseInt(belanja);

            $("#kembalian").text("Rp " + parseInt(a).toLocaleString());
            $("#kembalianVal").val(a);

            $("#totalBayar").text("Rp " + parseInt($("#modalTranJumlahUang").val()).toLocaleString());
        }
    }




    function cancelBill() {

        $("#itemPos").html("");
        $("#customer").text("+ Add Customer");
        $("#subtotal").text("Rp 0");
        $("#valSubtotal").val("0");
        $("#ppn").text("Rp 0");
        $("#totalItem").text("0 Item");
        $("#totalBayar").text("Rp 0");
        $('#customer_name').val("");
        $('#discount').val("0");
        $('#totalBelanja').text("0");
        $('#totalBelanjaVal').val("0");
        $('#modalTranJumlahUang').val("");
        $('#kembalian').text("Rp");
        $('#kembalianVal').val("0");
        $('#totalItemBayar').text("0 Item ");
        $('#totalItemBayarVal').val("0");
        $('#modalTranReason').val("");
        $('#totalPos').text("Rp " + "0");
        $('#totalPosVal').val("0");

        const ed = new Date();
        pktr = ed.getFullYear() + "" + ed.getMonth() + "" + ed.getDate() + "" + ed.getHours() + "" + ed.getMinutes() + "" + ed.getSeconds() + ed.getMilliseconds();

        var i;
        //alert("tabcontent.length "+$('.inputpos').length);
        for (i = 0; i < $('.inputpos').length; i++) {
            $('#qtyPos' + i).val("1");
        }

    }


    function cekBarang(kode, idx) {
        var d = new Date();
        var mnth = parseInt(d.getMonth()) + 1;
        var nowe = d.getFullYear() + "-" + mnth + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
        $.post("https://api-rki.rkicoop.co.id/api/pos/InsUpDelPos", {
            cmd: "insPosSimple",
            userIns: $('#login_userId').val(),
            kop_id: $("#login_kop_id").val(),
            pk: pktr,
            kode: kode,
            qtyPos: $("#qtyPos" + idx).val(),
            nowe: nowe
        },
            function (data, status) {
                //alert("Data: " + data + "\nStatus: " + status);
                var c = 1;
                var b = "";
                var totalPos = 0;
                var total = 0;
                var ppn = 0;
                var subtotal = 0;
                var totalItem = 0;
                var ppnYn = $("#ppnYn").val();
                //var discount

                const myArr = JSON.parse(data);
                if (myArr.length == 0) {
                    salert("Tidak Ada Data", 'warning', 'Warning');
                } else {

                    struk = " <body onload='window.print()'> ";
                    struk = struk + " <div class='ticket'> ";
                    struk = struk + "     <center><!--<img style='margin:auto;' src='../template/files/assets/images/Atous.png' width='20' height='20' alt='Logo'>--> ";
                    struk = struk + "     <p style='font-size:10px;' class='centered'>Struk Belanja ";
                    struk = struk + "         <br>Tanggal : " + myArr[0]["tglTran"] + " ";
                    struk = struk + "         <br>" + myArr[0]["fac_name"] + " ";
                    struk = struk + "         <br>" + myArr[0]["fac_address"] + "</p></center>   ";
                    struk = struk + "   <hr>  ";


                    strukDtl = "";
                    strukDtl = strukDtl + "     <table width='100%'> ";
                    strukDtl = strukDtl + "         <thead> ";
                    strukDtl = strukDtl + "             <tr> ";
                    strukDtl = strukDtl + "                 <th style='font-size:10px;text-align:left;' class='quantity'>Qty</th> ";
                    strukDtl = strukDtl + "                 <th style='font-size:10px;text-align:left;' class='description'>Item</th> ";
                    strukDtl = strukDtl + "                 <th style='font-size:10px;text-align:right;' class='price'>Harga</th> ";
                    strukDtl = strukDtl + "             </tr> ";
                    strukDtl = strukDtl + "         </thead> ";
                    strukDtl = strukDtl + "         <tbody> ";



                    b = b + " <div class='row' style='font-size: 12px;'> ";
                    b = b + " <div class='col-5 mt-1' style='padding-left:0px !important;padding-right:0px !important;'> ";
                    b = b + " Item ";
                    b = b + " </div> ";

                    b = b + " <div class='col-1 text-right' style='padding-left:0px !important;padding-right:0px !important;'> ";
                    b = b + " Qty ";
                    b = b + " </div> ";

                    b = b + " <div class='col-2 text-right' style='padding-left:0px !important;padding-right:0px !important;'> ";
                    b = b + " Harga ";
                    b = b + " </div> ";

                    b = b + " <div class='col-4 text-right' style='padding-left:0px !important;padding-right:0px !important;'> ";
                    b = b + " Amount ";
                    b = b + " </div> ";
                    b = b + " </div> ";

                    for (var i = 0; i < myArr.length; i += 1) {

                        strukDtl = strukDtl + "             <tr> ";
                        strukDtl = strukDtl + "                 <td style='font-size:10px;text-align:left;width:10%' class='quantity'>" + myArr[i]["qty"] + " X</td> ";
                        strukDtl = strukDtl + "                 <td style='font-size:10px;text-align:left;width:60%' class='description'>" + myArr[i]["nama_barang"] + "</td> ";
                        strukDtl = strukDtl + "                 <td style='font-size:10px;text-align:right;width:30%' class='price'>" + parseInt(myArr[i]["harga"]).toLocaleString() + "</td> ";
                        strukDtl = strukDtl + "             </tr> ";



                        c = c + 1;
                        b = b + " <div class='row' style='font-size: 12px;'> ";
                        b = b + " <div class='col-5 mt-1' style='padding-left:0px !important;padding-right:0px !important;'> ";
                        b = b + " " + myArr[i]["nama_barang"] + " ";
                        b = b + " </div> ";

                        b = b + " <div class='col-1 text-right' style='padding-left:0px !important;padding-right:0px !important;'> ";
                        b = b + " " + myArr[i]["qty"] + "x ";
                        b = b + " </div> ";

                        b = b + " <div class='col-2 text-right' style='padding-left:0px !important;padding-right:0px !important;'> ";
                        b = b + " " + parseInt(myArr[i]["harga"]).toLocaleString() + " ";
                        b = b + " </div> ";

                        b = b + " <div class='col-4 text-right' style='padding-left:0px !important;padding-right:0px !important;'> ";
                        b = b + " " + parseInt(myArr[i]["amount"]).toLocaleString() + " ";
                        b = b + " </div> ";
                        b = b + " </div> ";

                        jumlah_pos = jumlah_pos + 1;
                        totalPos = totalPos + parseInt(myArr[i]["total"]);
                        totalItem = totalItem + parseInt(myArr[i]["qty"]);


                    }
                    strukDtl = strukDtl + " </tbody> ";
                    strukDtl = strukDtl + " </table> ";
                    strukDtl = strukDtl + " <hr> ";
                    strukDtl = strukDtl + " <table width='100%'> ";
                    strukDtl = strukDtl + "    <tr> ";
                    strukDtl = strukDtl + "       <td style='font-size:10px;text-align:left;width:10%' class='quantity'>" + totalItem + " X</td> ";
                    strukDtl = strukDtl + "       <td style='font-size:10px;text-align:left;width:60%' class='description'>TOTAL</td> ";






                }


                //alert(ppnYn);
                ppn = parseInt(totalPos * 11 / 100);
                if (ppnYn == "000001") {
                    total = totalPos + ppn;
                    $('#ppn').text(ppn.toLocaleString());
                    $('#ppnVal').val(ppn);
                } else {
                    total = totalPos;
                    $('#ppn').text("0");
                    $('#ppnVal').val("0");
                }


                $('#subtotal').text(totalPos.toLocaleString());
                $('#valSubtotal').val(totalPos);
                $('#totalItem').text(totalItem + " Item");
                $('#totalPos').text("Rp " + parseInt(total).toLocaleString());
                $('#totalPosVal').val(total);
                $('#itemPos').html(b);
                //$('#total').text(total.toLocaleString());
                //$('#discount').text();

            }).fail(function (e) {
                console.log(e);
            });

    }


    function addCustomer() {
        Swal.fire({
            title: "Masukan Nama Customer",
            text: "Hi:",
            input: 'text',
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            showCancelButton: true
        }).then((result) => {
            if (result.value) {
                $("#customer").text(result.value);
                $("#customer_name").val(result.value);
                console.log("Result: " + result.value);
            }
        });
    }

    function printStruck(real_amount, dibayar, kembalian, noAntrian) {

        var newWin = window.frames["printf"];
        newWin.document.body.innerHTML = '';

        struk = struk + "  <center><p style='font-size:12px;font-weight:bold;' class='centered'>No Antrian : " + noAntrian + "<p></center>";
        struk = struk + strukDtl;
        struk = struk + "       <td style='font-size:10px;text-align:right;width:30%' class='price'>Rp " + parseInt(real_amount).toLocaleString() + "</td> ";
        struk = struk + "    </tr> ";
        struk = struk + "    <tr> ";
        struk = struk + "       <td  style='font-size:10px;text-align:left;width:10%' class='description'>&nbsp;</td> ";
        struk = struk + "       <td  style='font-size:10px;text-align:left;width:60%' class='description'>Bayar</td> ";
        struk = struk + "       <td style='font-size:10px;text-align:right;width:30%' class='price'>Rp " + parseInt(dibayar).toLocaleString() + "</td> ";
        struk = struk + "    </tr> ";
        struk = struk + "    <tr> ";
        struk = struk + "       <td  style='font-size:10px;text-align:left;width:10%' class='description'>&nbsp;</td> ";
        struk = struk + "       <td  style='font-size:10px;text-align:left;width:60%' class='description'>Kembalian</td> ";
        struk = struk + "       <td style='font-size:10px;text-align:right;width:30%' class='price'>Rp " + parseInt(kembalian).toLocaleString() + "</td> ";
        struk = struk + "    </tr> ";
        struk = struk + " </table>";

        struk = struk + " <center style='font-size:10px;' > ";
        struk = struk + "    <p class='centered'>Thanks for your purchase! </p><br> ";
        struk = struk + "    <p class='centered'>&nbsp; </p><br> ";
        struk = struk + "    <p class='centered'>&nbsp; </p> ";
        struk = struk + "     </center><br><br> ";
        struk = struk + " </div> ";
        struk = struk + " </body> ";
        newWin.document.write(struk);
        newWin.focus();
        newWin.print();

    }

    function printStruckPPOB() {
        salert("oke");
        //var newWin = window.frames["printfStruk"];
        //newWin.document.write(struk);
        //newWin.focus();
        //newWin.print();
    }




    function clearForm() {
        var a = document.getElementsByName("tab-idx");
        if (a[0].className.search("active") > 0) {

            pktr = d.getFullYear() + "" + d.getMonth() + "" + d.getDate() + "" + d.getHours() + "" + d.getMinutes() + "" + d.getSeconds() + d.getMilliseconds();
            $('#totalPos').text("Rp " + "0");
            $('#totalPosVal').val("0");
            $('#tableResult2').html("");
            //$('#tableResult3').html(s);
            $('#t1_barcode').val("");

        } else if (a[1].className.search("active") > 0) {
            //getNUmber();
        }
    }

    function showReport() {

        var myWindow = window.open("/view/erp/php/recipt.php?p[]=" + pktr + "&p[]=" + $("#login_kop_id").val(), "", "width=400,height=600");

    }


    function bayar() {
        if ($('#totalPosVal').val() == "" || $('#totalPosVal').val() == 0) {
            salert("Keranjang Belanja Masih Kosong ! ", "warning", "Warning");
        } else {
            $('#totalBelanja').text($('#totalPos').text());
            $('#totalBelanjaVal').val($('#totalPosVal').val());
            //$('#totalBayar').text("");
            //$('#kembalian').text("");
            $('#totalItemBayar').text($('#totalItem').text());
            $('#totalItemBayarVal').val($('#totalItem').text().replace("Item", ""));
            openModalTran();
        }

    }

    function openModalTran() {
        $("#modalTran").modal("show");
    }

    function hideModalTran() {
        $("#modalTran").modal("hide");
    }

    function fnInquery() {
        var a = document.getElementsByName("tab-idx");
        if (a[0].className.search("active") > 0) {
            salert("Not Setting Tab 1!", 'warning', 'Warning');
        } else if (a[1].className.search("active") > 0) {
            salert("Not Setting Tab 2!", 'warning', 'Warning');
        }
    }

    function fnSave() {
        var a = document.getElementsByName("tab-idx");
        if (a[0].className.search("active") > 0) {
            salert("Not Setting Tab 1!", 'warning', 'Warning');
        } else if (a[1].className.search("active") > 0) {

        }
    }




</script>
<!-- Row start -->
<div class="row" id="start">

    <div class="col-12 col-sm-6 col-md-7  ">
        <ul class="nav nav-tabs md-tabs " role="tablist" style="display: flex !important;border-bottom: 0px ;">
            <li class="nav-item" style="width:calc(100% / 3) !important" onclick="selAllItem('');">
                <a class="nav-link active" data-toggle="tab" href="#all" role="tab" id="tab_entry">
                    <i class="icofont icofont-list"></i>&nbsp; All Item </a>
                <div class="slide"></div>
            </li>

            <li class="nav-item  " style="width:calc(100% / 3) !important" onclick="selAllItem('000001');">
                <a class="nav-link " data-toggle="tab" href="#food" role="tab" id="tab_query">
                    <i class="icofont icofont-list"></i>&nbsp; Food </a>
                <div class="slide"></div>
            </li>

            <li class="nav-item  " style="width:calc(100% / 3) !important" onclick="selAllItem('000002');">
                <a class="nav-link " data-toggle="tab" href="#nonfood" role="tab" id="tab_query">
                    <i class="icofont icofont-list"></i>&nbsp; Non Food </a>
                <div class="slide"></div>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content " style="font-family:Calibri">
            <div name="tab-idx" class="tab-pane active" id="all" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <div class="input-group" style="margin-bottom: 0px !important;margin-top: 5px !important;">
                            <input type="text" id="textAllSearch" class="form-control txt_hris">
                            &nbsp;
                            <div class="input-group-append">
                                <button onclick="searchItem();" class="input-group-text bg-info "><i
                                        class="fa fa-search "></i> &nbsp;&nbsp;Cari Item
                                </button>&nbsp;&nbsp;&nbsp;&nbsp;
                                <button onclick="refreshItem();" class="input-group-text bg-warning "><i
                                        class="fa fa-rotate "></i> &nbsp;&nbsp;Refresh
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row" id="posItem"
                    style="overflow:auto;scrollbar-color:#56699d transparent;scrollbar-width:thin;">
                </div>
            </div>
            <div name="tab-idx" class="tab-pane " id="food" role="tabpanel">
                <div class="row" id="posItemFood"
                    style="overflow:auto;scrollbar-color:#56699d transparent;scrollbar-width:thin;">

                </div>
            </div>
            <div name="tab-idx" class="tab-pane " id="nonfood" role="tabpanel">
                <div class="row" id="posItemNonFood"
                    style="overflow:auto;scrollbar-color:#56699d transparent;scrollbar-width:thin;">

                </div>
            </div>

        </div>
    </div>

    <div class="col-12 col-sm-6 col-md-5">
        <div style="border-top:1px solid;" class="mb-2 "> </div>
        <div class="text-center mb-2 "> POS ITEM </div>
        <div class="row font-weight-bold m-1">
            <div class="col" id="itemPos" style="overflow:auto;">

            </div>
        </div>

        <div style="height:1px;border-bottom:1px solid;"></div>

        <div class="row font-weight-bold m-1" style="font-size: 12px;display:none">

            <div class="col-6 mt-1">
                Discount
            </div>
            <div class="col-2">

            </div>
            <div class="col-4">
                <input type="number" placeholder="Rp 0" class="form-control txt_hris" id="discount"
                    style="border: 0;outline: 0;border-bottom: 2px solid blue;">
            </div>

        </div>
        <div class="row font-weight-bold m-1" style="font-size: 12px;">

            <div class="col-6 mt-1">
                Sub Total
            </div>
            <div class="col-2">

            </div>
            <div class="col-4">
                <span id="subtotal">Rp 0</span><input type="hidden" id="valSubtotal">
            </div>

        </div>
        <div class="row font-weight-bold m-1 text-gray" style="font-size: 12px;">

            <div class="col-6 mt-1">
                PPN
            </div>
            <div class="col-2">

            </div>
            <div class="col-4">
                <span id="ppn">Rp 0</span><input type="hidden" id="ppnVal">
            </div>

        </div>

        <div class="row font-weight-bold m-1 text-gray" style="font-size: 12px;">

            <div class="col-6 mt-1">
                Total Item
            </div>
            <div class="col-2">

            </div>
            <div class="col-4">
                <span id="totalItem">0 Item</span>
            </div>

        </div>
        <div class="row font-weight-bold m-1 text-gray" style="font-size: 12px;">

            <div class="col-6 mt-1">
                Total
            </div>
            <div class="col-2">

            </div>
            <div class="col-4">
                <input type="hidden" id="totalPosVal">
                <span id="totalPos">Rp 0 </span>
            </div>

        </div>

        <div class="row">
            <div class="col-6">
                <button class="btn btn-warning m-1" id="clear" style="font-weight: bold;width:100%;"
                    onclick="cancelBill();"> Cancel

                </button>
            </div>
            <div class="col-6">
                <button class="btn btn-success m-1" id="savebill" onclick="bayar();"
                    style="font-weight: bold;width:100%;"> Bayar
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-md-6 col-lg-4">
                <div class="form-group" style="margin-bottom:0 !important;"
                    title="gunakan Master Setting-> POS SETTING -> PPN untuk pengaturan default (000001->PPN dan 000002->NO PPN)">
                    <input type="hidden" id="dineYn" value="000001"><!-- 000001 Direct  000002 TAKE AWAY -->
                    <select class="form-control  m-1" style="width:100%;font-weight:bold;font-size: 12px;" id="ppnYn">
                        <option value="000002">NO PPN</option>
                        <option value="000001">PPN</option>
                    </select>
                    <small id="" class="form-text text-muted">Potong PPN atau Tidak
                    </small>
                </div>
            </div>
            <div class="col-sm-6 col-md-6 col-lg-4">
                <div class="form-group" style="margin-bottom:0 !important;"
                    title="gunakan Master Setting-> POS SETTING -> PRINTER untuk pengaturan default (000001->58 , 000002->80 , 000003-> NO PRINT )">
                    <select class="form-control  m-1" style="width:100%;font-weight:bold;font-size: 12px;" id="strukYn">
                        <option value="000001">PRINT 58</option>
                        <option value="000002">PRINT 80</option>
                        <option value="000003">NO PRINT</option>
                    </select>
                    <small id="" class="form-text text-muted">Ukuran Kertas Printer
                    </small>
                </div>
            </div>

            <div class="col-sm-6 col-md-6 col-lg-4">
                <div class="form-group" style="margin-bottom:0 !important;"
                    title="gunakan Master Setting-> POS SETTING -> NO MEJA ">
                    <select class="form-control  m-1" style="width:100%;font-weight:bold;font-size: 12px;"
                        id="nomor_meja">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                    <small id="" class="form-text text-muted">Nomor Meja
                    </small>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                <input type="hidden" id="customer_name" value="">
                <button class="btn btn-info m-1" id="customer" style="font-weight: bold;width:100%;"
                    onclick="addCustomer()">+ Add
                    Customer Name
                </button>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                <div class="form-group" style="margin-bottom:0 !important;"
                    title="digunakan untuk print ulang struk belanja jika ada kesalahan atau kebutuhan lain">

                    <button onclick="rePrintStruk();" class="form-control btn btn-info m-1"><i class="fa fa-print "></i>
                        &nbsp;&nbsp;RePrint
                    </button>
                    <small id="" class="form-text text-muted">Print Ulang Struk
                    </small>
                </div>
            </div>
        </div>

    </div>



</div>


<!-- The Modal -->
<div class="modal " id="modalTran">
    <div class="modal-dialog modal-xl modal-dialog-top">
        <div class="modal-content">
            <div class="modal-header bg-success ">
                <span style="font-weight:bold ;">Pembayaran </span> <button type="button" class="close"
                    data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body " style="font-weight:bold;">
                <div class="row">
                    <div class="col-6 col-sm-6">
                        <div class="form-group">
                            <span style="font-weight:bold ;">Dibayar </span>
                            <input type="number" class="form-control font-weight-bold" id="modalTranJumlahUang"
                                placeholder="Jumlah Uang" onkeyup="toMoney()">
                        </div>
                    </div>

                    <div class="col-6 col-sm-6">
                        <div class="form-group">
                            <span style="font-weight:bold ;">Metode Pembayaran </span>
                            <select class="form-control " style="width:100%;padding: 2px;font-weight: bold;"
                                id="modalTranTypeBayar">
                                <option value="000001">CASH</option>
                                <option value="000002">QRIS</option>
                                <option value="000003">TRANSFER BANK</option>
                                <option value="000004">KARTU KREDIT</option>
                                <option value="000005">KARTU DEBIT</option>
                                <option value="000006">VIRTUAL ACCOUNT</option>
                                <option value="000007">XENDIT</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-12 col-sm-12" style="display: none;">
                        <input type="textarea" class="form-control" id="modalTranReason"
                            placeholder="Catatan Pembayaran">
                    </div>
                    <div class="col-12 col-sm-12" style="display: none;">
                        <button class="btn btn-info mt-2" id="modalTranCaraBayar"
                            style="font-weight: bold;width:100%;">+
                            Pembayaran Cara Lain
                        </button>
                    </div>

                </div>
                <div class="row">
                    <div class="col-12">
                        <table class="table">

                            <tbody>
                                <tr>
                                    <td>Total Belanja</th>
                                    <td id="totalBelanja">0</td><input type="hidden" id="totalBelanjaVal">
                                    <td>Total Bayar</td>
                                    <td id="totalBayar">0</td>
                                </tr>
                                <tr>
                                    <td>Total Item </th>
                                    <td id="totalItemBayar">0</td><input type="hidden" id="totalItemBayarVal">
                                    <td>Kembalian</td>
                                    <td id="kembalian">0</td><input type="hidden" id="kembalianVal">
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-sm-12">
                        <button class="btn btn-success " id="modalTranSubmit" style="font-weight: bold;width:100%;"
                            onclick="savePos()">Submit
                            Pembayaran
                        </button>
                        <iframe id="printf" name="printf" style="display:none;"></iframe>
                        <!-- test print
                        <button class="btn btn-success " id="modalTranSubmit" style="font-weight: bold;width:100%;"
                            onclick="printStruck()">print
                            Pembayaran
                        </button>
                        -->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
